$SMLNJ/cm/MAP-CM.txt

Toplevel description file for new (2000) implementation of CM

CDF: CM/cm-lib.cm

(* ---------------------------- Exports ---------------------------- *)

	functor LinkCM
	functor BootstrapCompileFn

	signature VERSION ?
	structure Version
	structure Sharing
	signature TOOLS ?
	structure Subst

	structure StdConfig


(* ---------------------------- Module Index ---------------------------- *)

LOCAL: [paths relative to $SMLNJ/cm]

  GroupGraph             depend/ggraph.sml
  DependencyGraph	 depend/graph.sml
  CheckSharing		 depend/checksharing.sml
  Reachable		 depend/reachable.sml
  DAEnv			 depend/da-env.sml 
  Statenv2DAEnv		 depend/se2dae.sml
  BuildDepend		 depend/build.sml
  MkList		 depend/mklist.sml

  CMLrValsFun 		 parse/cm.grm.sml (<- cm.grm)
  CMLexFun		 parse/cm.lex.sml (<= cm.lex)

  SRCPATH		 paths/srcpath.sml 
  SrcPath		 paths/srcpath.sml 
  SrcPathSet		 paths/srcpathset.sml
  SrcPathMap		 paths/srcpathmap.sml
  TStamp		 paths/tstamp.sml
  FILEID		 paths/fileid.sml 
  FileId		 paths/fileid.sml 

  CMSemant		 semant/semant.sml
  GroupReg		 semant/group-reg.sml
  IInfo			 semant/iinfo.sml
  VERSION		 semant/version.sml 
  Version		 semant/version.sml 
  Sharing		 semant/sharing.sml
  GROUPREG		 semant/group-reg.sml 
  GroupReg		 semant/group-reg.sml 
  MEMBERCOLLECTION	 semant/members.sml 
  MemberCollection	 semant/members.sml 
  CM_SEMANT		 semant/semant.sml 
  CMSemant		 semant/semant.sml 

  SmlInfo		 smlfile/smlinfo.sml
  SmlInfoSet		 smlfile/smlinfoset.sml 
  SmlInfoMap		 smlfile/smlinfomap.sml 
  Skeleton		 smlfile/skeleton.sml
  SkelIO		 smlfile/skel-io.sml
  SkelCvt		 smlfile/skel-cvt.sml
  SkelExports		 smlfile/skel-exports.sml

  STABILIZE		 stable/stabilize.sml
  STAB_MODMAP		 stable/stabmm.sml
  VerStabFn		 stable/verify.sml
  BinInfo		 stable/bininfo.sml
  StableSet		 stable/stableset.sml
  StableMap		 stable/stablemap.sml

  GeneralParams	 	 main/general-params.sml
  PervAccess		 main/perv-access.sml
  FILENAMEPOLICY	 main/filename-policy.sml
  FilenamePolicyFN	 main/filename-policy.sml
  FilenamePolicy	 main/filename-policy.sml

  SafeIO		 util/safeio.sml
  StringSet		 util/stringset.sml
  SymbolSet		 util/symbolset.sml
  SymbolMap		 util/symbolmap.sml
  SetFn			 util/set-fn.sml
  MapFn			 util/map-fn.sml
  AutoDir		 util/autodir.sml
  Memoize		 util/memoize.sml <<<BUG?
  PidSet		 util/pidset.sml
  IntMap		 util/int-map.sml
  Seek			 util/seek.sml

  PARSE			 parse/parse.sml
  ParseFn		 parse/parse.sml
  CM_TOKENS		 parse/cm.grm.sig
  CM_LRVALS		 parse/cm.grm.sig

  PRIVATETOOLS		 tools/main/private-tools.sig 
  PrivateTools		 tools/main/private-tools.sml
  LSplitArg		 tools/main/lsplit-arg.sml (?)
  CORETOOLS		 tools/main/core-tools.sig
  TOOLS			 tools/main/public-tools.sig
  ToolsFn		 tools/main/tools-fn.sml

  COMPILE		 compile/compile.sml
  CompileFn		 compile/compile.sml
  CoreHack		 compile/corehack.sml
  BFC			 compile/bfc.sml
  BfcFn			 compile/bfc.sml

  GeneralParams		 main/general-params.sml
  FILENAMEPOLICY	 main/filename-policy.sml
  FilenamePolicyFn	 main/filename-policy.sml
  SYMVAL		 main/symval.sml
  SymVal		 main/symval.sml
  PervAccess		 main/perv-access.sml
  
  BtNames		 bootstrap/names.sml
  MkBootList		 bootstrap/mkbootlist.sml
  CMBSlaveHook		 bootstrap/cmb-slave-hook
  BootstrapCompileFn	 bootstrap/btcompile.sml
  BUILD_INIT_DG 	 bootstrap/build-initdg.sml
  BuildInitDG 		 bootstrap/build-initdg.sml
  CMBSlave		 bootstrap/cmb-slave-stub.sml
  CMBSlaveHook		 bootstrap/cmb-slave-hook.sml

  Concur		 concur/concur.sml
  Servers		 concur/dummy-servers.sml,unix-servers.sml


IMPORTS: [paths relative to $SMLNJ]

  LrParser		mlyacc-lib.cm
  JoinWithArg		mlyacc-lib.cm
  PARSER_DATA		mlyacc-lib.cm ?

  Symbol		compiler/Basics/symbol/symbol.sml
  Source		compiler/Basics/source/source.sml (basics.cm)
  SourceMap		compiler/Basics/source/sourcemap.sml (basics.cm)
  PPSourceMap		compiler/Basics/source/ppsourcemap.sml (basics.cm)
  BasicControl		compiler/Basics/control/basiccontrol.sml

  PickleUtil		compiler/Library/pickle/pickle-util.sml
  UnpickleUtil		compiler/Library/unpickle-util.sml

  StaticEnv		compiler/ElabData/statenv/statenv.sml
  BrowseStatEnv		compiler/ElabData/statenv/browse.sml
  PickleSymPid		compiler/ElabData/pickle/pickle-sym-pid.sml 
  UnpickleSymPid	compiler/ElabData/pickle/unpickle-sym-pid.sml

  Binfile		compiler/Execution/binfile/binfile.sml

  Controls		$smlnj-lib/controls-lib.cm
  ControlUtil		$smlnj-lib/controls-lib.cm
  ControlRegistry	$smlnj-lib/controls-lib.cm

  LibBase		smlnj-lib.cm (smlnj-lib/Util)
  FormatComb		smlnj-lib.cm
  RedBlackSetFn         smlnj-lib.cm 
  RedBlackMapFn         smlnj-lib.cm 
  
  SMLNJVersion		system/smlnj/internal/version.sml (smlnj-version.cm) 



(* ---------------------------- Members [files] ---------------------------- *)
Imports from outside this library are indicated by an asterisk (e.g. LambdaVar*).
[We assume import of basis.cm, so Basis modules are not mentioned.]


CM/

(* the CM description file parser *)
parse/

  parse.sml
    < PARSE
      ParseFn
    > GroupGraph
      DependencyGraph
      CMLrValsFun
      CMLexFun
      SrcPath
      SrcPathMap
      CMSemant
      GroupReg 
      SmlInfo
      STAB_MODMAP
      STABILIZE
      GeneralParams
      SafeIO
      ---------------
      LibBase ?
      LrParser
      Source
      SourceMap
      PPSourceMap
      ErrorMsg
      Formatting

  % cm.grm : MLYacc -->
  cm.grm.sig
    < CM_TOKENS
      CM_LRVALS
    > CMSemant
      --------
      PARSER_DATA

  cm.grm.sml
    < CMLrValsFun
    > CMSemant
      CM_TOKENS
      --------
      SourceMap

  % cm.lex : MLLex -->
  cm.lex.sml
    < CMLexFun
    > CM_TOKENS

semant/
  sharing.sml
    < Sharing
    >

  iinfo.sml
    < IInfo
    > ---------
      StaticEnv
      PersStamps

  group-reg.sml
    < GROUPREG
      GroupReg
    > SrcPath
      SrcPathMap
      -------
      Source
      SourceMap
      ErrorMsg

  (* semantic actions for description file parser *)
  version.sml
    < VERSION
      Version
    > 

  members.sml
    < MEMBERCOLLECTION
      MemberCollection
    > SmlInfo
      SrcPath
      SrcPathMap
      GeneralParams
      DependencyGraph
      GroupGraph
      PrivateTools
      SymbolSet
      SymbolMap
      Version
      -------
      Symbol
      SourceMap
      ErrorMsg

  semant.sml
    < CM_SEMANT
      CMSemant
    > SrcPath
      Version
      SymbolSet
      SymbolMap
      GroupGraph
      GeneralParams
      MemberCollection
      PrivateTools
      PervAccess
      -------
      Symbol
      SourceMap
      ErrorMsg

(* dependency graphs *)
depend/
  graph.sml
    < DependencyGraph
    > SymbolSet
      SmlInfo 
      BinInfo
      IInfo
      DAEnv
      -----

  build.sml
    < BUILDDEPEND
      BuildDepend
    > SymbolMap
      SymbolSet
      SrcPath
      SmlInfo
      SmlInfoMap
      DAEnv
      CheckSharing
      Skeleton
      GroupGraph
      DependencyGraph 
      GeneralParams
      -------------
      Symbol
      SymPath
      ErrorMsg
      Formatting

  da-env.sml
    < DAEnv
    > SymbolSet
      ---------
      Symbol

  se2dae.sml
    < STATENV2DAENV
      Statenv2DAEnv
    > SymbolSet
      DAEnv
      ------
      Symbol
      StaticEnv
      BrowseStatEnv

  ggraph.sml
    < GroupGraph
    > StringSet
      SrcPath
      SrcPathMap
      Version
      DependencyGraph

  reachable.sml
    < REACHABLE
      Reachable
    > GroupGraph
      DependencyGraph
      SmlInfoSet
      SrcPathSet
      SrcPathMap
      StableSet
      BinInfo

  checksharing.sml
    < CHECKSHARING
      CheckSharing
    > DependencyGraph
      SymbolMap
      SmlInfo
      SmlInfoMap
      StringSet
      GeneralParams
      Sharing
      --------
      ErrorMsg
      Formatting

  mklist.sml
    < MkList
    > SymbolMap
      BinInfo
      SmlInfo
      SmlInfoSet 
      StableSet
      GroupGraph
      DependencyGraph

  indegree.sml
    < INDEGREE
      Indegree
    > GroupGraph
      DependencyGraph
      SmlInfoMap
      SymbolMap

  index.sml
    < INDEX
      Index
    > GeneralParams
      SmlInfo
      SymbolMap
      GroupGraph
      DependencyGraph
      SrcPath
      FilenamePolicy
      --------------
      Symbol
      ErrorMsg

  to-portable.sml
    < ToPortable
    > GroupGraph
      DependencyGraph
      PortableGraph
      GeneralParams
      SrcPath
      SrcPathMap
      SymbolSet
      SmlInfo
      SmlInfoMap
      StableMap
      SymbolMap
      ---------
      Symbol

(* handling SML source code *)
smlfile/
  smlinfo.sml
    < SMLINFO
      SmlInfo
    > SrcPath
      SrcPathMap
      GeneralParams
      Skeleton
      SkelIO
      SkelCvt
      SymbolSet
      Sharing
      TStamp
      FileNamePolicy
      GroupReg
      AutoDir
      -------
      Symbol
      Ast
      StaticEnv
      Source
      SourceMap
      PPSourceMap
      SmlFile 
      ErrorMsg
      
  smlinfoset.sml
    < SmlInfoSet
    > SmlInfo
      SetFn 
      -----

  smlinfomap.sml
    < SmlInfoMap
    > SmlInfo
      MapFn
      -----
      
  skeleton.sml
    < Skeleton
    > SymbolSet
      ---------
      Symbol
      SymPath
      
  skel-cvt.sml
    < SKELCVT
      SkelCvt
    > Skeleton
      SymbolSet
      --------
      Symbol
      SymPath
      Ast
      SourceMap
      ErrorMsg

  skel-io.sml
    < SKELIO
      SkelIO
    > Skeleton
      SymbolSet
      TStamp
      SafeIO
      ------
      Symbol
      SymPath
      PickleUtil
      UnpickleUtil
      PickleSymPid
      UnpickleSymPid

  skel-exports.sml
    < SKELEXPORTS
      SkelExports
    > Skeleton
      SymbolSet
      ---------


(* handling stable groups *)
stable/
  bininfo.sml
    < BININFO
      BinInfo
    > SrcPath
      Sharing
      -------
      PersStamps
      SourceMap 
      ErrorMsg

  stabmm.sml
    < STAB_MODMAP
      StabModmapFn
    > ---------
      StaticEnv
      ModuleId
      GenModIdMap
      
  stablemap.sml
    < StableMap
    > MapFn
      BinInfo
      -------

  stableset.sml
    < StableSet
    > SetFn
      BinInfo
      -------

  stabilize.sml
    < STABILIZE
      StabilizeFn
    > GroupGraph
      DependencyGraph
      GeneralParams
      Sharing
      StableMap
      Memoize
      StringSet
      SymbolSet 
      SymbolMap
      SrcPath
      SrcPathMap
      STAB_MODMAP
      SmlInfo
      BinInfo
      SmlInfoMap
      SafeIO
      FileNamePolicy
      DAEnv
      Statenv2DAEnv 
      -------------
      PersStamps 
      ModuleId 
      PickleUtil
      UnpickleUtil
      PickleSymPid 
      UnpickleSymPid 
      PickMod
      UnpickMod
      BinFile 
      Formatting 
      SourceMap 
      ErrorMsg

  verify.sml
    < VERIFY_STABLE
      VerStabFn
    > STABILIZE
      GroupGraph
      DependencyGraph
      GeneralParams
      SymbolMap
      TStamp
      SrcPath
      SrcPathSet
      Version
      SmlInfo
      SmlInfoSet
      StableMap
      FileNamePolicy
      Reachable
      ---------
      

(* tools for handling other source types *)
tools/main/
  lsplit-arg.sml (obsolete?)
    < LSplitArg
    > -------

  core-tools.sig
    < CORETOOLS
    > Sharing
      Version
      -------
      
  public-tools.sig
    < TOOLS
    > CORETOOLS

  private-tools.sig
    < PRIVATETOOLS
    > CORETOOLS
      SrcPath
      -------

  private-tools.sml
    < PrivateTools
    > PRIVATETOOLS
      SrcPath
      Sharing
      Version
      StringMap ?
      SrcPathMap
      AutoDir
      SafeIO
      -------
      Controls
      ControlRegistry
      BasicControl
      
  tools-fn.sml
    < ToolsFn
    > TOOLS
      SrcPath
      PrivateTools
      Say
      StdConfig
      Subst
      -----------
      ControlUtil


(* doing actual compilation work *)
compile/
  compile.sml
    < COMPILE
      CompileFn
    > GeneralParams
      DependencyGraph
      GroupGraph
      SymbolSet
      SymbolMap
      PidSet
      SrcPath
      SrcPathSet
      SmlFile      
      SmlInfo
      SmlInfoMap
      BinFile
      IInfo
      Memoize
      StabModmap
      STAB_MODMAP
      Concur
      Servers
      AutoDir
      SafeIO
      TStamp
      CoreHack
      ------------
      StaticEnv
      BrowseStatEnv
      PersStamps
      Pid
      Rehash
      UnpickMod
      CompileExn
      EnvRef
      BACKEND
      Backend
      ErrorMsg
      Formatting 
      SMLNJVersion

  corehack.sml
    < CoreHack
    > ---
      Symbol
      Ast
      CoreSym

  link.sml
    < LINK
      LinkFn
    > GeneralParams
      DependencyGraph
      GroupGraph
      SymbolMap 
      SrcPath
      SrcPathSet
      SrcPathMap
      SmlInfo
      SmlInfoMap
      BinInfo
      BinFile
      IntMap 
      Sharing
      StableMap
      BFC
      Memoize
      ----------
      StaticEnv
      DynamicEnv
      Execute 
      ErrorMsg
      Formatting

  bfc.sml
    < BFC
      BfcFn
    > SmlInfo
      SmlInfoMap
      BinFile
      SafeIO
      Seek
      ------------
      SMLNJVersion

(* overall control of CM *)
main/
  general-params.sml
    < GeneralParams
    > SrcPath
      FileNamePolicy
      GroupReg
      TStamp
      ------

  filename-policy.sml
    < FILENAMEPOLICY
      FilenamePolicyFn
    > SrcPath
      Version
      -------
      [SMLofNJ.SysInfo]

  symval.sml
    < SYMVAL
      SymVal
    > StringMap
      ---------
      LibBase
      [SMLofNJ.SysInfo]

  specific-symval-fn.sml
    < SpecificSymValFn
    > SymVal
      ------------
      ErrorMsg
      SMLNJVersion
      [SMLofNJ.SysInfo]

  autoload.sml
    < AUTOLOAD
      AutoLoadFn
    > Say
      BFC
      COMPILE
      GeneralParams
      DependencyGraph
      GroupGraph
      SymbolSet
      SymbolMap
      StdConfig
      Statenv2DAEnv
      BuildDepend
      -----------
      BrowseStatEnv
      Symbol
      Ast
      Environment 
      EnvRef
      ErrorMsg

  cleanup.sml
    < Cleanup
    > ----------
      ControlRegistry
      BasicControl

  slave.sml
    < Slave
    > DependencyGraph
      BtNames
      Say
      SrcPath
      SrcPathMap
      ----------
      [Signals, OS.Process]

  preload.sml
    < Preload
    > SafeIO
      ------

  cm-boot.sml
    < LinkCM [fct]
    > Say
      StringSet
      DependencyGraph
      GroupGraph
      SrcPath
      SrcPathMap
      IntMap
      SpecificSymValFn
      StabModmapFn
      FilenamePolicy
      ParseFn
      CompileFn
      LinkFn
      BfcFn 
      AutoLoadFn
      ToolsFn
      StabilizeFn
      Servers
      StdConfig
      SafeIO
      GroupReg					
      Cleanup
      MkBootList
      ------------
      Symbol
      BACKEND
      StaticEnv 
      DynamicEnv
      Environment 
      EnvRef
      PrintControl
      FormatComb (?)
      ErrorMsg
      [SMLofNJ.SysInfo, OS.Path, OS.FileSys]

  perv-access.sml
    < PervAccess
    > ------
      Symbol

(* bootstrap compiler (formerly known as "batch") *)
bootstrap/

  names.sml
    < BtNames
    > -------

  build-initdg.sml
    < BUILD_INIT_DG
      BuildInitDG
    > DependencyGraph
      GeneralParams
      Say
      StringMap 
      SrcPath
      SmlInfo
      Sharing
      GroupReg
      SafeIO
      ------
      Source
      SourceMap
      ErrorMsg
      Control

  btcompile.sml
    < BootstrapComileFn
    > GroupGraph
      DependencyGraph
      BuildInitDG
      SrcPath
      SrcPathMap
      SpecificSymValFn
      Binfile
      BinInfo
      FilenamePolicy
      StableSet
      StableMap
      Reachable
      StabModmapFn
      CompileFn
      StabilizeFn
      VerStabFn
      ParseFn
      MkBootList
      Servers
      Concur
      GroupReg
      AutoDir
      IInfo
      BtNames
      StdConfig
      SafeIO
      CMBSlaveHook
      ----------
      PersStamps
      StaticEnv
      DynamicEnv
      BACKEND
      Control (TopLevel)
      ErrorMsg
      

  mkbootlist.sml
    < MkBootList
    > BinInfo
      SmlInfo
      StableSet
      MkList
      ------
      PersStamps

  cmb-slave-stub.sml
    < CMBSlave
    > StringSet
      CMBSlaveHook
      ------------

  cmb-slave-hook.sml
    < CMBSlaveHook
    > GroupGraph
      DependencyGraph
      SrcPath
      StringMap
      ---------

paths/  -- Library

  srcpath-lib.cm

  srcpath.sml
    < SRCPATH
      SrcPath
    > FileId
      ------
      RedBlackMapFn [-> StringMap]

  srcpathset.sml
    < SrcPathSet
      ---------
      RedBlackSetFn

  srcpathmap.sml
    < SrcPathMap
    > SrcPath
      ----------
      RedBlackMapFn

  tstamp.sml
    < TStamp
    > ------
      [Time, OS.FileSys]

  fileid
    < FILEID
      FileId
    > -------
      [OS.FileSys, OS.Path]


(* ---------------------------- Imports ---------------------------- *) 

(* CM-internal libraries *)
util/sources.cm
concur/sources.cm  (concurrent/parallel/distributed make)
$smlnj/internal/srcpath-lib.cm (paths/srcpath-lib.cm)

(* Basis *)
$smlnj/basis/basis.cm

(* smlnj-lib *)
$smlnj/smlnj-lib/smlnj-lib.cm
$smlnj/smlnj-lib/controls-lib.cm
$smlnj/smlnj-lib/prettyprint-lib.cm

(* viscomp *)
$smlnj/viscomp/basics.cm
$smlnj/viscomp/parser.cm
$smlnj/viscomp/elabdata.cm
$smlnj/viscomp/execute.cm

$/pickle-lib.cm ($compiler/Library/pickle/pickle-lib.cm)

(* auxiliary libraries *)
$smlnj/ml-yacc/ml-yacc-lib.cm
$/pgraph.cm ($SMLNJ/libraries/pgraph/pgraph.cm)
$smlnj/internal/smlnj-version.cm

(* ---------------------------- Notes ---------------------------- *) 
